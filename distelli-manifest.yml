easae/seoa11y-api:
  # Distelli Manifest example
  # this example assumes the build and deploy servers are:
  # Ubuntu 12.04
  Env:
    - NODE_ENV: development
    - PORT: 3000
    - JWT_SECRET: 0a6b944d-d2fb-46fc-a85e-0295c986cd9f
    - MONGO_HOST: mongodb://localhost
    - MONGO_PORT: 27017
    - MONGO_DB: pa11yapi

  PreBuild:
    - sudo add-apt-repository ppa:ubuntu-toolchain-r/test
    - sudo apt-get -y update
    - sudo apt-get -y install gcc-5.1 g++-5.1 build-essential libssl-dev curl
    - sudo rm /usr/bin/g++
    - sudo ln -s /usr/bin/g++-5 /usr/bin/g++
    - curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.32.0/install.sh | bash
  Build:
    - nvm install 6.5
    - nvm use 6.5
    - n=$(which node);n=${n%/bin/node};chmod -R 755 $n/bin/*;sudo cp -r $n/{bin,lib,share} /usr/local
    - sudo npm install
    - npm run build

  PkgInclude:
    - 'dist/'
    - 'node_modules/'

  Start:
    - sudo npm install -g pm2
    - sudo pm2 stop all || true
    - sudo pm2 delete all || true
    - sudo NODE_ENV=$NODE_ENV PORT=$PORT JWT_SECRET=$JWT_SECRET MONGO_HOST=$MONGO_HOST MONGO_PORT=$MONGO_PORT MONGO_DB=$MONGO_DB pm2 start dist/index.js
