easae/seoa11y-api:
  # Distelli Manifest example
  # this example assumes the build and deploy servers are:
  # Ubuntu 12.04
  Env:
    - NODE_ENV: development
    - PORT: 3000
    - JWT_SECRET: 0a6b944d-d2fb-46fc-a85e-0295c986cd9f
    - MONGO_HOST: mongodb://localhost
    - MONGO_PORT: 27017
    - MONGO_DB: pa11yapi

  PreBuild:
    - sudo apt-get install python-software-properties
    - sudo add-apt-repository ppa:ubuntu-toolchain-r/test
    - sudo apt-get -y update
    - sudo apt-get -y install g++-4.8 gcc-4.8 build-essential libssl-dev curl
    - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.8 50
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.8 50
    - sudo update-alternatives --set g++ /usr/bin/g++-4.8
    - sudo update-alternatives --set gcc /usr/bin/gcc-4.8
    - curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.32.0/install.sh | bash
  Build:
    - nvm install 6.5
    - nvm use 6.5
    - gcc -v
    - g++ -v
    - npm install
    - npm run build

  PkgInclude:
    - 'dist/'
    - 'node_modules/'

  Start:
    - sudo npm install -g pm2
    - sudo pm2 stop all || true
    - sudo pm2 delete all || true
    - sudo NODE_ENV=$NODE_ENV PORT=$PORT JWT_SECRET=$JWT_SECRET MONGO_HOST=$MONGO_HOST MONGO_PORT=$MONGO_PORT MONGO_DB=$MONGO_DB pm2 start dist/index.js
